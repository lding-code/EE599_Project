!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("@ngstack/code-editor",["exports","@angular/core","rxjs","@angular/common"],t):t(((e=e||self).ngstack=e.ngstack||{},e.ngstack["code-editor"]={}),e.ng.core,e.rxjs,e.ng.common)}(this,(function(e,t,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var r=function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function s(e,t){return function(n,o){t(n,o,e)}}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function c(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}function p(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function d(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}var f=new t.InjectionToken("EDITOR_SETTINGS"),h=function(){function e(e){this.baseUrl="https://unpkg.com/monaco-editor/min",this.typingsWorkerUrl="https://unpkg.com/@ngstack/code-editor/workers/typings-worker.js",this.typingsLoaded=new n.Subject,this.loaded=new n.Subject,this.loadingTypings=new n.BehaviorSubject(!1);var t=r({baseUrl:this.baseUrl,typingsWorkerUrl:this.typingsWorkerUrl},e);this.baseUrl=t.baseUrl,this.typingsWorkerUrl=t.typingsWorkerUrl}return e.prototype.loadTypingsWorker=function(){var e=this;if(!this.typingsWorker&&window.Worker){if(this.typingsWorkerUrl.startsWith("http")){var t="importScripts('"+this.typingsWorkerUrl+"');",n=URL.createObjectURL(new Blob([t],{type:"text/javascript"}));this.typingsWorker=new Worker(n)}else this.typingsWorker=new Worker(this.typingsWorkerUrl);this.typingsWorker.addEventListener("message",(function(t){e.loadingTypings.next(!1),e.typingsLoaded.next(t.data)}))}return this.typingsWorker},e.prototype.loadTypings=function(e){if(e&&e.length>0){var t=this.loadTypingsWorker();t&&(this.loadingTypings.next(!0),t.postMessage({dependencies:e}))}},e.prototype.loadEditor=function(){var e=this;return new Promise((function(t,n){var o=function(){if(window.require.config({paths:{vs:e.baseUrl+"/vs"}}),e.baseUrl.startsWith("http")){var n='\n            self.MonacoEnvironment = {\n              baseUrl: "'+e.baseUrl+"\"\n            };\n            importScripts('"+e.baseUrl+"/vs/base/worker/workerMain.js');\n          ",o=URL.createObjectURL(new Blob([n],{type:"text/javascript"}));window.MonacoEnvironment={getWorkerUrl:function(){return o}}}window.require(["vs/editor/editor.main"],(function(){e.loaded.next({monaco:monaco}),t()}))};if(window.require)o();else{var r=document.createElement("script");r.type="text/javascript",r.src=e.baseUrl+"/vs/loader.js",r.addEventListener("load",o),document.body.appendChild(r)}}))},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[f]}]}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(f,8))},token:e,providedIn:"root"}),e=i([t.Injectable({providedIn:"root"}),s(0,t.Optional()),s(0,t.Inject(f)),a("design:paramtypes",[Object])],e)}(),y=function(){function e(e){var t=this;e.loaded.subscribe((function(e){t.setup(e.monaco)})),e.typingsLoaded.subscribe((function(e){t.updateTypings(e)}))}return e.prototype.setup=function(e){if(e){this.monaco=e;var t=e.languages.typescript.typescriptDefaults;t.setCompilerOptions({target:e.languages.typescript.ScriptTarget.ES6,module:"commonjs",noEmit:!0,noLib:!0,emitDecoratorMetadata:!0,experimentalDecorators:!0,allowNonTsExtensions:!0,declaration:!0,lib:["es2017","dom"],baseUrl:".",paths:{}}),t.setMaximumWorkerIdleTime(-1),t.setEagerModelSync(!0)}},e.prototype.updateTypings=function(e){e&&(this.addExtraLibs(e.files),this.addLibraryPaths(e.entryPoints))},e.prototype.addExtraLibs=function(e){if(void 0===e&&(e=[]),this.monaco&&e&&0!==e.length){var t=this.monaco.languages.typescript.typescriptDefaults,n=t.getExtraLibs();e.forEach((function(e){n[e.path]||(t._extraLibs[e.path]=e.content)})),t._onDidChange.fire(t)}},e.prototype.addLibraryPaths=function(e){if(void 0===e&&(e={}),this.monaco){var t=this.monaco.languages.typescript.typescriptDefaults.getCompilerOptions();t.paths=t.paths||{},Object.keys(e).forEach((function(n){t.paths[n]=[e[n]]}))}},e.ctorParameters=function(){return[{type:h}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(h))},token:e,providedIn:"root"}),e=i([t.Injectable({providedIn:"root"}),a("design:paramtypes",[h])],e)}(),g=function(){function e(e){var t=this;e.loaded.subscribe((function(e){t.setup(e.monaco)})),e.typingsLoaded.subscribe((function(e){t.updateTypings(e)}))}return e.prototype.setup=function(e){if(e){this.monaco=e;var t=e.languages.typescript.javascriptDefaults;t.setCompilerOptions({target:e.languages.typescript.ScriptTarget.ES6,module:"commonjs",allowNonTsExtensions:!0,baseUrl:".",paths:{}}),t.setMaximumWorkerIdleTime(-1),t.setEagerModelSync(!0)}},e.prototype.updateTypings=function(e){e&&(this.addExtraLibs(e.files),this.addLibraryPaths(e.entryPoints))},e.prototype.addExtraLibs=function(e){if(void 0===e&&(e=[]),this.monaco&&e&&0!==e.length){var t=this.monaco.languages.typescript.javascriptDefaults,n=t.getExtraLibs();e.forEach((function(e){n[e.path]||(t._extraLibs[e.path]=e.content)})),t._onDidChange.fire(t)}},e.prototype.addLibraryPaths=function(e){if(void 0===e&&(e={}),this.monaco){var t=this.monaco.languages.typescript.javascriptDefaults.getCompilerOptions();t.paths=t.paths||{},Object.keys(e).forEach((function(n){t.paths[n]=[e[n]]}))}},e.ctorParameters=function(){return[{type:h}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(h))},token:e,providedIn:"root"}),e=i([t.Injectable({providedIn:"root"}),a("design:paramtypes",[h])],e)}(),m=function(){function e(e){var t=this;e.loaded.subscribe((function(e){t.setup(e.monaco)}))}return e.prototype.setup=function(e){if(e){this.monaco=e;var t=e.languages.json.jsonDefaults;t.setDiagnosticsOptions({validate:!0,allowComments:!0,schemas:l(t._diagnosticsOptions.schemas,[{uri:"http://myserver/foo-schema.json",schema:{type:"object",properties:{p1:{enum:["v1","v2"]},p2:{$ref:"http://myserver/bar-schema.json"}}}},{uri:"http://myserver/bar-schema.json",schema:{type:"object",properties:{q1:{enum:["x1","x2"]}}}}])})}},e.prototype.addSchemas=function(e,t){var n,o;void 0===t&&(t=[]);var r=this.monaco.languages.json.jsonDefaults,i=r.diagnosticsOptions,s={};i&&i.schemas&&i.schemas.length>0&&i.schemas.forEach((function(e){s[e.uri]=e}));try{for(var a=u(t),c=a.next();!c.done;c=a.next()){var p=c.value,d=p.uri,l=p.schema;s[d]={uri:d,schema:l,fileMatch:[e||"*.json"]}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}i.schemas=Object.values(s),r.setDiagnosticsOptions(i)},e.ctorParameters=function(){return[{type:h}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(h))},token:e,providedIn:"root"}),e=i([t.Injectable({providedIn:"root"}),a("design:paramtypes",[h])],e)}(),v=function(){function e(e,n,o,r){this.editorService=e,this.typescriptDefaults=n,this.javascriptDefaults=o,this.jsonDefaults=r,this.defaultOptions={lineNumbers:!0,contextmenu:!1,minimap:{enabled:!1}},this.subscriptions=[],this.theme="vs",this.options={},this.readOnly=!1,this.valueChanged=new t.EventEmitter,this.loaded=new t.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.ngOnDestroy=function(){this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions=[],this._editor&&(this._editor.dispose(),this._editor=null),this._model&&(this._model.dispose(),this._model=null)},e.prototype.ngOnChanges=function(e){e.codeModel&&!e.codeModel.firstChange&&this.updateModel(e.codeModel.currentValue),e.readOnly&&!e.readOnly.firstChange&&this._editor&&this._editor.updateOptions({readOnly:e.readOnly.currentValue}),e.theme&&!e.theme.firstChange&&monaco.editor.setTheme(e.theme.currentValue)},e.prototype.onResize=function(){this._editor&&this._editor.layout()},e.prototype.ngAfterViewInit=function(){return c(this,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,this.editorService.loadEditor()];case 1:return e.sent(),this.setupEditor(),this.loaded.emit(),[2]}}))}))},e.prototype.setupEditor=function(){var e=this,t=this.editorContent.nativeElement,n=r({value:"",language:"text",uri:"code"},this.codeModel);this._model=monaco.editor.createModel(n.value,n.language,monaco.Uri.file(n.uri));var o=Object.assign({},this.defaultOptions,this.options,{readOnly:this.readOnly,theme:this.theme,model:this._model});this._editor=monaco.editor.create(t,o),this._model.onDidChangeContent((function(t){var n=e._model.getValue();e.codeModel&&(e.codeModel.value=n),e.valueChanged.emit(n)})),this.setupDependencies(this.codeModel)},e.prototype.setupDependencies=function(e){if(e){var t=e.language;if(t)switch(t.toLowerCase()){case"typescript":case"javascript":e.dependencies&&this.editorService.loadTypings(e.dependencies);break;case"json":e.schemas&&this.jsonDefaults.addSchemas(e.uri,e.schemas)}}},e.prototype.setEditorValue=function(e){var t=this;setTimeout((function(){t._model&&t._model.setValue(e)}))},e.prototype.updateModel=function(e){e&&(this.setEditorValue(e.value),this._model&&void 0!==typeof monaco&&monaco.editor.setModelLanguage(this._model,e.language),this.setupDependencies(e))},e.ctorParameters=function(){return[{type:h},{type:y},{type:g},{type:m}]},i([t.ViewChild("editor",{static:!0}),a("design:type",t.ElementRef)],e.prototype,"editorContent",void 0),i([t.Input(),a("design:type",Object)],e.prototype,"codeModel",void 0),i([t.Input(),a("design:type",Object)],e.prototype,"theme",void 0),i([t.Input(),a("design:type",Object)],e.prototype,"options",void 0),i([t.Input(),a("design:type",Object)],e.prototype,"readOnly",void 0),i([t.Output(),a("design:type",Object)],e.prototype,"valueChanged",void 0),i([t.Output(),a("design:type",Object)],e.prototype,"loaded",void 0),i([t.HostListener("window:resize"),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",void 0)],e.prototype,"onResize",null),e=i([t.Component({selector:"ngs-code-editor",template:'<div id="editor" #editor class="monaco-editor editor"></div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None,host:{class:"ngs-code-editor"},styles:[".editor{width:100%;height:inherit;min-height:200px}"]}),a("design:paramtypes",[h,y,g,m])],e)}(),b=function(){function e(){}var n;return n=e,e.forRoot=function(e){return{ngModule:n,providers:[{provide:f,useValue:e},h,y,g,m]}},e.forChild=function(){return{ngModule:n}},e=n=i([t.NgModule({imports:[o.CommonModule],declarations:[v],exports:[v]})],e)}();e.CodeEditorComponent=v,e.CodeEditorModule=b,e.CodeEditorService=h,e.EDITOR_SETTINGS=f,e.JavascriptDefaultsService=g,e.TypescriptDefaultsService=y,e.ɵb=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngstack-code-editor.umd.min.js.map